local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Command = "LHQ"

local Activated = false

local function SelectedScript()
    local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

-- ===== Ã‚M THANH GITHUB =====
local function GitAud(soundlink, filename)
	if not isfile(filename .. ".mp3") then
		writefile(filename .. ".mp3", game:HttpGet(soundlink))
	end
	return (getcustomasset or getsynasset)(filename .. ".mp3")
end

local function CustomGitSound(soundlink, vol, filename, duration)
	local s = Instance.new("Sound")
	s.SoundId = GitAud(soundlink, filename)
	s.Volume = vol
	s.Looped = true
	s.Parent = workspace
	s:Play()

	task.delay(duration, function()
		if s then s:Destroy() end
	end)
end

-- ===== LOAD SPAWNER =====
local src = game:HttpGet("https://raw.githubusercontent.com/VoorPhale012/Fogroom/refs/heads/main/Wwwhyyyyil")
local spawner = loadstring(src)()

-- ===== CREATE ENTITY =====
local entity = spawner.Create({
	Entity = {
		Name = "Template Entity",
		Asset = "https://github.com/vuivuiviu2/Lunacy-mode/raw/refs/heads/main/jayvavva.rbxm",
		HeightOffset = 0
	},
	Lights = { Flicker = {Enabled=false}, Shatter=false, Repair=false },
	Earthquake = {Enabled=false},
	Movement = {Speed=60, Delay=3, Reversed=false},
	Damage = {Enabled=true, Range=40, Amount=999},
	Death = {
		Type="Guiding",
		Hints={"It heard the signal.", "Do not call it again."},
		Cause="LHQ"
	}
})

-- ===== JUNPSCARE FUNCTION =====
local function DoJumpscare(player)
	local playerGui = player:FindFirstChild("PlayerGui")
	if not playerGui then return end

	local screenGui = Instance.new("ScreenGui")
	screenGui.IgnoreGuiInset = true
	screenGui.ResetOnSpawn = false
	screenGui.Parent = playerGui

	local img = Instance.new("ImageLabel")
	img.Image = "rbxassetid://106729398431112" -- áº£nh jumpscare
	img.Size = UDim2.new(1,0,1,0)
	img.Position = UDim2.new(0,0,0,0)
	img.BackgroundTransparency = 1
	img.Parent = screenGui

	-- Hiá»‡n 3 giÃ¢y
	task.delay(3, function()
		screenGui:Destroy()
		game:Shutdown() -- kill game
	end)
end

-- ===== KHI GIáº¾T NGÆ¯á»œI CHÆ I â†’ JUNPSCARE + VÄ‚NG GAME =====
entity:SetCallback("OnDamagePlayer", function(newHealth)
	if newHealth <= 0 then
		local player = game.Players.LocalPlayer
		if player then
			DoJumpscare(player)
		else
			game:Shutdown()
		end
	end
end)

-- ===== CHAT TRIGGER =====
local spawned = false

local function onChat(player, msg)
	if spawned then return end
	if string.find(string.lower(msg), "lhq") then
		spawned = true

		-- ðŸ”Š PHÃT Ã‚M THANH KHI SPAWN
		CustomGitSound(
			"https://github.com/vuivuiviu2/Lunacy-mode/raw/refs/heads/main/JAYYYY.mp3",
			1,
			"LHQ_Sound",
			24
		)

		entity:Run()
	end
end

for _, p in ipairs(Players:GetPlayers()) do
	p.Chatted:Connect(function(m)
		onChat(p, m)
	end)
end

Players.PlayerAdded:Connect(function(p)
	p.Chatted:Connect(function(m)
		onChat(p, m)
	end)
end)
end

local function Activate()
    if Activated then return end
    Activated = true
    SelectedScript()
end

local function HookPlayer(player)
    player.Chatted:Connect(function(msg)
        if Activated then return end
        if msg == Command then
            Activate()
        end
    end)
end

for _, player in ipairs(Players:GetPlayers()) do
    HookPlayer(player)
end

Players.PlayerAdded:Connect(function(player)
    HookPlayer(player)
end)
